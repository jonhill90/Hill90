# Tailscale Management Reference

## Automated Setup (ONE Command)

Tailscale infrastructure is fully automated via `make tailscale-setup`:

```bash
# Setup Tailscale (Terraform + secrets) - FULLY AUTOMATED
make tailscale-setup
# This command:
# 1. Initializes Terraform
# 2. Generates pre-authorized auth key (90-day expiry)
# 3. Extracts the key from Terraform output
# 4. Stores it in encrypted secrets automatically
# DONE! No manual steps required.

# Rotate auth key when expired (90 days)
make tailscale-rotate
# Same as tailscale-setup, generates new key and updates secrets
```

**Manual Terraform operations (NOT needed, use make targets instead):**
```bash
# If you need to manually inspect:
cd infra/terraform/tailscale
terraform output -raw vps_auth_key  # View current auth key
terraform state list                # View Terraform resources
```

## VPS Installation (Automated via Ansible)

The bootstrap process automatically:
1. Installs Tailscale binary (via Ansible playbook 05-tailscale.yml)
2. Joins Tailscale network using auth key from secrets
3. Configures firewall to allow SSH from Tailscale network only (100.64.0.0/10)
4. Saves Tailscale IP to `/opt/hill90/.tailscale_ip`

## SSH via Tailscale

```bash
# Get Tailscale IP from VPS
ssh -i ~/.ssh/remote.hill90.com root@<public-ip> 'cat /opt/hill90/.tailscale_ip'

# SSH via Tailscale IP (use this for all SSH access)
ssh -i ~/.ssh/remote.hill90.com deploy@<tailscale-ip>

# Public SSH is BLOCKED by firewall
```

**Note**: Use Tailscale IP (100.68.116.66) for SSH. Public SSH on port 22 is blocked by firewall.

## Tailscale Configuration

- **Auth key:** Generated by Terraform, expires in 90 days
- **API key:** Used by Terraform provider (in terraform.tfvars)
- **Firewall:** SSH allowed only from Tailscale CGNAT range (100.64.0.0/10)
- **Tags:** VPS tagged as `tag:server`, `tag:hill90`
- **Current Tailscale IP:** 100.68.116.66 (from VPS `/opt/hill90/.tailscale_ip`)
