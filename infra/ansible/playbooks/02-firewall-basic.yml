---
# Basic Firewall Configuration Playbook
# Configures firewalld with HTTP/HTTPS ports (SSH remains public temporarily)

- name: Install firewalld
  dnf:
    name: firewalld
    state: present

- name: Enable and start firewalld
  systemd:
    name: firewalld
    enabled: yes
    state: started

- name: Configure firewall allowed ports (HTTP/HTTPS)
  firewalld:
    port: "{{ item }}"
    permanent: yes
    state: enabled
    immediate: yes
  loop: "{{ firewall_allowed_ports }}"

- name: Ensure SSH is allowed (temporarily, until Tailscale is configured)
  firewalld:
    service: ssh
    permanent: yes
    state: enabled
    immediate: yes

- name: Reload firewalld
  command: firewall-cmd --reload
  changed_when: false

- name: Display firewall status
  command: firewall-cmd --list-all
  register: firewall_status
  changed_when: false

- name: Show firewall configuration
  debug:
    var: firewall_status.stdout_lines
